<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TEST alert event functionality</title>
    <script src="../../src/gsc.js" type="text/javascript"></script>
    <script src="../../deps/jquery/jquery-2.1.4.min.js" type="text/javascript"></script>
    <script src="../../src/alertevent/alertevent.js" type="text/javascript"></script>

    <script>
        // initialize alertevent object
        var AE = gsc.alertevent.AE('http://geo.mapshakers.com:8080/CrowdSourcing');

        // callback function which catch the error or print the results to a console
        function print(err,data){
            if (err){
                console.error(err);
                return;
            }
            console.log(data);
        }

        // create unix uuid
        function createUuidgen(){
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                var r = crypto.getRandomValues(new Uint8Array(1))[0]%16|0, v = c == 'x' ? r : (r&0x3|0x8);
                return v.toString(16);
            });
        }


        // create timestamp in format "YYYY-MM-DDTHH:mm:ss"
        function getTimeStamp() {
            var now = new Date();
            return (now.getFullYear() + "-" +
            (now.getMonth() + 1) + '-' +
            (now.getDate()) + 'T' +
            now.getHours() + ':' +
            ((now.getMinutes() < 10)
                    ? ("0" + now.getMinutes())
                    : (now.getMinutes())) + ':' +
            ((now.getSeconds() < 10)
                    ? ("0" + now.getSeconds())
                    : (now.getSeconds())));
        }


        /** LIBRARY FUNCTIONS **/


        function getConfig() {
            AE.getConfig(print);
        }


        function eventComment(){
            var data = {
                "user": {
                    "id": "Filip_"+createUuidgen(),
                    "email": "franta@nowhere.com"
                },
                "text": "A new comment",
                "datetime":getTimeStamp()
            };

            var uuid = "5ed32063-45bd-4ac2-9f68-0bf8efa38814";
            AE.eventComment(print,data,uuid);
        }

        function eventCreate1(){

            var data ={
                "id":createUuidgen(),
                "description": "An event with 1 attachment",
                "media": [{"type": "image/jpeg", "uri": "part://1"}],
                "user": {
                    "id": "Filip_"+createUuidgen(),
                    "email": "karel@unckle.com",
                    "role": "admin",
                    "organization": "family"
                },
                "location": {
                    "lat": 23.43,
                    "lon": 33.1,
                    "crs": "epsg:4326"
                },
                "priority": "normal",
                "datetime": getTimeStamp(),
                "status": "submitted"
            };

            var request = new FormData();
            request.append('event', JSON.stringify(data));
            request.append('part://1', $('input[type=file]')[0].files[0]);

            AE.eventCreate(print,request);
        }

        function eventCreate2(){

            var data ={
                "id":createUuidgen(),
                "description": "An event with 2 attachments",
                "media": [
                    {"type": "image/jpeg", "uri": "part://1"},
                    {"type": "image/jpeg", "uri": "part://2"}
                ],
                "user": {
                    "id": "Filip_"+createUuidgen(),
                    "email": "karel@unckle.com",
                    "role": "admin",
                    "organization": "family"
                },
                "location": {
                    "lat": 23.43,
                    "lon": 33.1,
                    "crs": "epsg:4326"
                },
                "priority": "normal",
                "datetime": getTimeStamp(),
                "status": "submitted"
            };

            var request = new FormData();
            request.append('event', JSON.stringify(data));
            request.append('part://1', $('input[type=file]')[0].files[0]);
            request.append('part://2', $('input[type=file]')[0].files[0]);

            AE.eventCreate(print,request);
        }



        function eventListFilterBbox(){

            var data ={
                "bbox": {
                    "lat-min": 23,
                    "lon-min": 33.1,
                    "lat-max": 24,
                    "lon-max": 33.1,
                    "crs": "epsg:4326"
                }
            };

            AE.eventListFilter(print,data);
        }


        function eventListFilterDateTime1(){

            var data ={
                "datetime": {
                    "from": "2015-12-05T10:32:00"
                }
            };

            AE.eventListFilter(print,data);
        }

        function eventListFilterDateTime2(){

            var data ={
                "datetime": {
                    "from": "2014-12-03T00:00:00",
                    "to": "2015-12-03T00:00:00"
                }
            };

            AE.eventListFilter(print,data);
        }

        function eventListFilterDateTime3(){

            var data ={
                "datetime": {
                    "to": "2015-12-03T00:00:00"
                }
            };

            AE.eventListFilter(print,data);
        }

        function eventListFilterEmpty(){

            var data ={};

            AE.eventListFilter(print,data);
        }

        function eventListFilterPriority(){

            var data ={
                "priority": [
                ]
            };

            AE.eventListFilter(print,data);
        }
    </script>
</head>
<body>
<h1>Hello, it's me.</h1>
<p> Just open your dev console and wonder happens </p>
<p>
    <button onclick="getConfig()">get config</button>
    <button onclick="eventComment()">event comment</button>
    <button onclick="eventCreate1()">event create 1</button>
    <button onclick="eventCreate2()">event create 2</button>
    <button onclick="eventListFilterBbox()">filter bbox</button>
    <button onclick="eventListFilterDateTime1()">filter datetime from</button>
    <button onclick="eventListFilterDateTime2()">filter datetime from to</button>
    <button onclick="eventListFilterDateTime3()">filter datetime to</button>
    <button onclick="eventListFilterEmpty()">filter empty</button>
    <button onclick="eventListFilterPriority()">filter priority</button>


<form id="upload" method="post" action="" enctype="multipart/form-data">
    <input class="input-file" id="fileInput" type="file" name="file">
</form>
</p>
</body>
</html>